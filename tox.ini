[tox]
envlist =
	test
	test_wheel

# This checks the sdist can build
[testenv:test]
deps =
	hypothesis
passenv =
	HYPOTHESIS_PROFILE
commands =
	# TODO: work out what to do with print_platform
	# python -c 'import pyroaring; pyroaring.print_platform()'
	python test.py
	python -c "import cydoctest, pyroaring; cydoctest.testmod(pyroaring)" -v


[testenv:test_wheel]
deps =
	hypothesis
	wheel
	twine
skip_sdist = true
skip_install = true
passenv =
	HYPOTHESIS_PROFILE
allowlist_externals =
	rm
	mkdir
commands =
	# Clear our prebuilt wheels so we have a fresh directory
    - mkdir wheel
    - rm wheel/*
    # Build the wheel into the cleaned directory
	pip wheel . -w wheel
	# Install from the wheel in that directory
	pip install --only-binary ":all:" --find-links=wheel pyroaring
	python test.py
	python -c "import cydoctest, pyroaring; cydoctest.testmod(pyroaring)" -v


